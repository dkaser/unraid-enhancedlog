<?xml version='1.0' standalone='yes'?>

<!DOCTYPE PLUGIN [
<!ENTITY name       "enhanced.log">
<!ENTITY author     "dlandon">
<!ENTITY version    "2016.01.14">
<!ENTITY launch    "Utilities/SyslogSettings">
<!ENTITY pluginURL  "https://github.com/dlandon/enhanced.log/raw/master/enhanced.log.plg">
<!ENTITY MD5		"34ec65e3fcf4509a95e338f073153996">
]>

<PLUGIN  name="&name;"
         author="&author;"
         version="&version;"
         launch="&launch;"
         pluginURL="&pluginURL;">

<CHANGES>
##&name;
###&version;
- Fixed match strings causing false positives related to pre-clear messages.

###2016.01.12
- Fixed match strings order - "checksumming" before "checksum".

###2016.01.05
- Fixed false positives - "dev error handler" and "not tainted".

###2015.01.04
- Modified error and login match strings to help prevent false positives and prioritize highlighting.

###2015.12.29
- Initial unRAID V6.1 release.
</CHANGES>

<!--
Copyright 2015, Dan Landon
his plugin adds a webGui page to view the system log with highlighted lines.
You can enable or disable event highlighting and set your own colors for each event.
You can add your own search string to highlight in the log.
-->

<!--
The 'pre-install' script.
-->
<FILE Run="/bin/bash">
<INLINE>
source /etc/unraid-version
if [[ ${version:0:3} == 6.0 ]]; then
  echo "unRAID version 6.1 or higher is required"
  exit 1
fi

# Remove emhttp files so we can re-install.
rm -rf /usr/local/emhttp/plugins/&name;/* 2>/dev/null

# Remove old 'bundle' files.
rm -f $(ls /boot/config/plugins/&name;/&name;*.tgz 2>/dev/null | grep -v '&version;')
</INLINE>
</FILE>

<!--
Get the plugin bundle.
-->
<FILE Name="/boot/config/plugins/&name;/&name;-&version;.tgz">
<URL>"https://github.com/dlandon/&name;/raw/master/&name;-&version;.tgz"</URL>
<MD5>&MD5;</MD5>
</FILE>

<!--
Install the plugin bundle.
-->
<FILE Run="/bin/bash">
<INLINE>
# Create plugin directory
mkdir /boot/config/plugins/&name; 2>/dev/null

# Install the 'bundle'.
tar -xf /boot/config/plugins/&name;/&name;-&version;.tgz -C /usr/local/emhttp/plugins 2>/dev/null

# Adjust plugin permissions.
chmod 755 -R /usr/local/emhttp/plugins/&name; 2>/dev/null
</INLINE>
</FILE>

<FILE Name="/boot/config/plugins/&name;/&name;.cfg">
<INLINE>
<![CDATA[
TEXT="yes"
ERRORS="yes"
MINOR_ISSUES="yes"
LIME_TECH="yes"
ARRAY="yes"
SYSTEM="yes"
FILE_SYSTEM="yes"
DRIVE_RELATED="yes"
NETWORK="yes"
LOGIN="yes"
EMHTTP="no"
OTHER="no"
ERRORS_CLR="HotPink"
MINOR_ISSUES_CLR="LemonChiffon"
LIME_TECH_CLR="LimeGreen"
ARRAY_CLR="HoneyDew"
SYSTEM_CLR="LightGreen"
FILE_SYSTEM_CLR="Gainsboro"
DRIVE_RELATED_CLR="AliceBlue"
NETWORK_CLR="Thistle"
LOGIN_CLR="Lavender"
EMHTTP_CLR="Azure"
OTHER_CLR="SeaShell"
]]>
</INLINE>
</FILE>

<FILE Name="/boot/config/plugins/&name;/custom_syslog.conf">
<INLINE>
<![CDATA[
"Recycle Bin", "other"
]]>
</INLINE>
</FILE>

<!--
The 'post-install' script.

-->
<FILE Run="/bin/bash">
<INLINE>
echo ""
echo "-----------------------------------------------------------"
echo " Plugin &name; is installed."
echo " Copyright 2015, Dan Landon"
echo " Version: &version;"
echo "-----------------------------------------------------------"
echo ""
</INLINE>
</FILE>

<!--
The 'remove' script.
-->
<FILE Run="/bin/bash" Method="remove">
<INLINE>
# Remove all plugin files.
rm -rf /boot/config/plugins/&name; 2>/dev/null
rm -rf /usr/local/emhttp/plugins/&name; 2>/dev/null

echo ""
echo "-----------------------------------------------------------"
echo " Plugin &name; has been removed."
echo " Version: &version;"
echo "-----------------------------------------------------------"
echo ""
</INLINE>
</FILE>

</PLUGIN>
